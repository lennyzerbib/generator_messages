<script>
  function getCode() {
    return new URLSearchParams(window.location.search).get("code") || "";
  }

  async function main() {
    const code = getCode();
    if (!code) {
      document.body.innerHTML = "<p style='color:red'>Erreur : code manquant.</p>";
      return;
    }

    const resp = await fetch(`/api/get-link?code=${encodeURIComponent(code)}`);
    if (!resp.ok) {
      document.body.innerHTML = "<p style='color:red'>Lien invalide ou expirÃ©.</p>";
      return;
    }

    const data = await resp.json();

    const digicodeImmeuble     = data.digicodeImmeuble || "";
    const digicodeAppartement  = data.digicodeAppartement || "";
    const wifi                 = data.wifi || "";
    const wifiPass             = data.wifiPass || "";
    const message              = data.message || "";

    const codesDiv = document.getElementById("importantCodes");
    codesDiv.innerHTML = `
      <p>ğŸ” Code immeuble : <strong>${digicodeImmeuble}</strong></p>
      <p>ğŸ”‘ Code appartement : <strong>${digicodeAppartement}</strong></p>
      <p>ğŸ“¶ Wifi : <strong>${wifi}</strong></p>
      <p>
        ğŸ” Mot de passe :
        <strong id="wifiPassText">${wifiPass}</strong>
        <button id="copyWifiBtn" class="copy-btn">Copier</button>
      </p>
    `;

    document.getElementById("messageBlock").textContent = message;

    const copyBtn    = document.getElementById("copyWifiBtn");
    const wifiPassEl = document.getElementById("wifiPassText");

    copyBtn.addEventListener("click", () => {
      navigator.clipboard.writeText(wifiPassEl.textContent.trim());
    });
  }

  main();
</script>
