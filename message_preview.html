<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Message invit√©</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      padding: 20px;
      background: #f7f7f7;
      color: #222;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 12px;
    }
    .codes {
      background: #ffffff;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      margin-bottom: 24px;
    }
    .codes p {
      margin: 6px 0;
      font-size: 18px;
      font-weight: 600;
      color: #2c3e50;
    }
    pre {
      white-space: pre-wrap;
      background: #ffffff;
      padding: 16px;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.5;
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }
    .copy-btn {
      font-size: 13px;
      margin-left: 8px;
      padding: 4px 10px;
      border-radius: 6px;
      border: 1px solid #3498db;
      background: #3498db;
      color: #fff;
      cursor: pointer;
    }
    .copy-btn:active {
      transform: translateY(1px);
    }
    .small-note {
      font-size: 12px;
      margin-top: 8px;
      color: #555;
    }
  </style>
</head>
<body>

  <h1>Informations pour le client</h1>

  <div class="codes" id="importantCodes"></div>

  <pre id="messageBlock"></pre>

  <script>
    //
    // üî• NOUVEAU : r√©cup√©ration du token dans l'URL
    //
    function getToken() {
      const parts = window.location.pathname.split("/p/");
      return parts[1] || null;
    }

    function decodeToken(token) {
      try {
        const json = decodeURIComponent(atob(token));
        return JSON.parse(json);
      } catch (e) {
        return null;
      }
    }

    const token = getToken();
    const data = decodeToken(token);

    if (!data) {
      document.body.innerHTML = "<p style='color:red'>Erreur : lien invalide.</p>";
      throw new Error("Invalid token");
    }

    //
    // üî• Les donn√©es d√©cod√©es du token
    //
    const digicodeImmeuble     = data.digicodeImmeuble || "";
    const digicodeAppartement  = data.digicodeAppartement || "";
    const wifi                 = data.wifi || "";
    const wifiPass             = data.wifiPass || "";
    const message              = data.message || "";

    //
    // üî• Affichage
    //
    const codesDiv = document.getElementById("importantCodes");
    codesDiv.innerHTML = `
      <p>üîê Code immeuble : <strong>${digicodeImmeuble}</strong></p>
      <p>üîë Code appartement : <strong>${digicodeAppartement}</strong></p>
      <p>üì∂ Wifi : <strong>${wifi}</strong></p>
      <p>
        üîè Mot de passe :
        <strong id="wifiPassText">${wifiPass}</strong>
        <button id="copyWifiBtn" class="copy-btn">Copier</button>
      </p>
      <p class="small-note">Cliquez sur "Copier" pour mettre le mot de passe dans votre presse-papiers.</p>
    `;

    document.getElementById("messageBlock").textContent = message;

    //
    // Copier le mot de passe WiFi
    //
    const copyBtn    = document.getElementById("copyWifiBtn");
    const wifiPassEl = document.getElementById("wifiPassText");

    copyBtn.addEventListener("click", () => {
      navigator.clipboard.writeText(wifiPassEl.textContent.trim()).then(() => {
        const old = copyBtn.textContent;
        copyBtn.textContent = "Copi√© ‚úÖ";
        setTimeout(() => copyBtn.textContent = old, 1500);
      });
    });
  </script>
</body>
</html>
